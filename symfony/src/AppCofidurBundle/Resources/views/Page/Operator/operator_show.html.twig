{% extends 'AppCofidurBundle::Page/Operator/operator.html.twig' %}

{% block sidebar_nav %}
	<h2><em><a href="javascript:history.go(-1)">Retour</a></em></h2>
	{{ parent() }}
{% endblock %}

{% block body %}
	<script src="{{ asset('bundles/appcofidur/js/sorttable.js') }}"></script>
	<script type="text/javascript">
		function display_subordinates(){
			var subordinates_list= document.getElementById("subordinates_list");

			/*** Rédéfinit le style de la partie des détails ***/
			/* Si le style a déjà été définit comme "à afficher", on le cache */
			if(subordinates_list.style.display == "block"){
				subordinates_list.style.display= "none";
				/* Si le style n'a pas été redéfinit ou qu'il est définit comme caché, on l'affiche */
			} else {
				subordinates_list.style.display= "block";
			}
		}
	</script>

	<h1> Résumé des compétences de {{ operator.firstname }} {{ operator.lastname }}</h1>

<table>
	<tr>
        {#<th> ID </th>#}
        <th> PRENOM </th>
        <th> NOM </th>
		<th> DATE DE NAISSANCE </th>
		<th> SUPERIEUR N+1 </th>
		<th> SUPERIEUR N+2 </th>
	</tr>
	<tr>
		{#<td> {{ operator.id }} </td>#}
        <td> {{ operator.firstName }} </td>
        <td> {{ operator.lastName }} </td>
        <td> {{ operator.dateOfBirth |date("d/m/Y")  }} </td>
		<td> {{ operator.superiorLvl1 }}</td>
		<td> {{ operator.superiorLvl2 }}</td>
	</tr>
</table>
<br/>
<br/>

<button id="display_subordinates" onclick="display_subordinates()">Afficher/Cacher les subalternes</button>
<div id="subordinates_list" style="display: none">
	{% if subordinates %}
	<h3>Liste des subalternes de {{ operator.firstname }} {{ operator.lastname }} :</h3>
	<table class="sortable">
		<tr>
			<th>NOM</th>
			<TH>PRENOM</TH>
		</tr>
		{% for subordinate in subordinates %}
		<tr>
			<td> {{ subordinate.lastname | upper }} </td>
			<td> {{ subordinate.firstname }}</td>
		</tr>
		{% endfor %}
	</table>
	{% else %}
		<h3>Vous n'êtes le chef d'aucun opérateur, désolé !</h3>
	{% endif %}
</div>



	{% if operatorsformations %}
	<h3>Légende des couleurs des cadres :</h3>
	<table class="color_legend">
		<tr>
			<th class="text_legende">Code couleur</th>
			<td class="formedNotValidated"></td>
			<td class="learningFormation"></td>
			<td class="futureFormation"></td>
			<td class="formedValidated"></td>
			<td class="formedToTeach"></td>
		</tr>
		<tr>
			<th class="text_legende">Statut</th>
			<td class="text_legende">Formé non habilité</td>
			<td class="text_legende">En Formation</td>
			<td class="text_legende">Prévision Formation</td>
			<td class="text_legende">Habilité</td>
			<td class="text_legende">Habilité à former</td>
		</tr>
	</table>

<h2>Cet opérateur suit les formations suivantes :</h2>
<table class="ope_formations_array">
	{% set sautdeligne= 0 %}
	{% for operatorformation in operatorsformations %}
		{% if sautdeligne is even %}
			<tr>
		{% endif %}

		<td class="ope_formations_array_elem">
			<fieldset 
			{% if 1 == operatorformation.validation %}
				 class="formedNotValidated_formation_sumup"
            {% endif %}
			{% if 2 == operatorformation.validation %}
				 class="learningFormation_formation_sumup"
            {% endif %}
			{% if 3 == operatorformation.validation %}
				 class="futureFormation_formation_sumup"
            {% endif %}
			{% if 4 == operatorformation.validation %}
				 class="formedValidated_formation_sumup"
            {% endif %}
			{% if 5 == operatorformation.validation %}
				 class="formedToTeach_formation_sumup"
            {% endif %}
            >
					<legend class="ope_formations_array_elem_legend">
						<a href="{{ path('AppCofidurBundle_operatorformation_show', {'idOpForm': operatorformation.id}) }}">Détails de la formation</a>
					</legend>
					<table class="category_page">
						{#<tr>#}
							{#<th class="entete_category">ID</th>#}
							{#<td>{{ operatorformation.formation.id }} </td>#}
						{#</tr>#}
						<tr>
							<th class="entete_category">Nom</th>
							<td>{{ operatorformation.formation.name }} </td>
						</tr>
						<tr>
							<th class="entete_category">Type</th>
							<td title="{{ operatorformation.formation.type }}">{{ operatorformation.formation.type| slice(0,30) }}... </td>
						</tr>
						<tr>
							<th class="entete_category">Objectif</th>
							<td title="{{ operatorformation.formation.goal }}">{{ operatorformation.formation.goal| slice(0,30) }}... </td>
						</tr>
						{#<tr>#}
							{#<th class="entete_category">Moyens pédagogiques</th>#}
							{#<td title="{{ operatorformation.formation.teachingAids }}">{{ operatorformation.formation.teachingAids| slice(0,30) }}... </td>#}
						{#</tr>#}
						{#<tr>#}
							{#<th class="entete_category">Lieu & moyens matériels</th>#}
							{#<td title="{{ operatorformation.formation.placesMaterialRessources }}">{{ operatorformation.formation.placesMaterialRessources| slice(0,30) }}... </td>#}
						{#</tr>#}
						<tr>
							<th class="entete_category">Criticité</th>
							<td>{{ operatorformation.formation.criticality }} </td>
						</tr>
						<tr>
							<th class="entete_category">Formateur</th>
							<td> {{ operatorformation.former.lastName | upper | slice(0.10) }} {{ operatorformation.former.firstName | slice(0.10) }}</td>
						</tr>
						<tr>
							<th class="entete_category">Temps écoulé depuis la fin de la formation</th>
							<td>{{ operatorformation.getFormationElapsedTime }} jour(s)</td>
						</tr>
						{#Valeur a changer : champ de validité a placer ici a la plac du 5#}
						{% if operatorformation.getFormationElapsedTime > operatorformation.formation.validityTime %}
							<tr><td>ATTENTION LA FORMATION N'EST PLUS VALIDE</td></tr>
						{% endif %}
					</table>
				</fieldset>
		</td>
		{% if sautdeligne is odd %}
			</tr>
		{% endif %}
		{% set sautdeligne= sautdeligne+1 %}
	{% endfor %}
</table>
{% else %}
	<h3>Cet opérateur n'a encore suivi aucune formation</h3>
{% endif %}

{# Formations supervisées par l'opérateur #}
{% if supervisedFormations %}
	<h2>Cet opérateur supervise les formations suivantes :</h2>
	<table class="ope_formations_array">
		{% set sautdeligne= 0 %}
		{% for supervisedFormation in supervisedFormations %}
			{% if sautdeligne is even %}
				<tr>
			{% endif %}

			<td class="ope_formations_array_elem">
				<fieldset
				{% if 1 == supervisedFormation.validation %}
					 class="formedNotValidated_formation_sumup"
				{% endif %}
				{% if 2 == supervisedFormation.validation %}
					 class="learningFormation_formation_sumup"
				{% endif %}
				{% if 3 == supervisedFormation.validation %}
					class="futureFormation_formation_sumup"
				{% endif %}
				{% if 4 == supervisedFormation.validation %}
					 class="formedValidated_formation_sumup"
				{% endif %}
				{% if 5 == supervisedFormation.validation %}
					 class="formedToTeach_formation_sumup"
				{% endif %}
				>
										<legend class="ope_formations_array_elem_legend">
											<a href="{{ path('AppCofidurBundle_operatorformation_show', {'idOpForm': supervisedFormation.id}) }}">Détails de la formation</a>
										</legend>
										<table class="category_page">
											{#<tr>#}
												{#<th class="entete_category">ID</th>#}
												{#<td>{{ supervisedFormation.formation.id }} </td>#}
											{#</tr>#}
											<tr>
												<th class="entete_category">Nom</th>
												<td>{{ supervisedFormation.formation.name }} </td>
											</tr>
											<tr>
												<th class="entete_category">Type</th>
												<td title="{{ supervisedFormation.formation.type }}">{{ supervisedFormation.formation.type| slice(0,30) }}... </td>
											</tr>
											<tr>
												<th class="entete_category">Objectif</th>
												<td title="{{ supervisedFormation.formation.goal }}">{{ supervisedFormation.formation.goal| slice(0,30) }}... </td>
											</tr>
											{#<tr>#}
												{#<th class="entete_category">Moyens pédagogiques</th>#}
												{#<td title="{{ supervisedFormation.formation.teachingAids }}">{{ supervisedFormation.formation.teachingAids| slice(0,30) }}... </td>#}
											{#</tr>#}
											{#<tr>#}
												{#<th class="entete_category">Lieu & moyens matériels</th>#}
												{#<td title="{{ supervisedFormation.formation.placesMaterialRessources }}">{{ sueprvisedFormation.formation.placesMaterialRessources| slice(0,30) }}... </td>#}
											{#</tr>#}
											<tr>
												<th class="entete_category">Criticité</th>
												<td>{{ supervisedFormation.formation.criticality }} </td>
											</tr>
											<tr>
												<th class="entete_category">Opérateur formé</th>
												<td>{{ supervisedFormation.operator.lastName | upper | slice(0.10) }} {{ supervisedFormation.operator.firstName | slice(0.10) }} </td>
											</tr>
											<tr>
												<th class="entete_category">Temps écoulé depuis la fin de la formation</th>
												<td>{{ supervisedFormation.getFormationElapsedTime }} jour(s)</td>
											</tr>
											{#Valeur a changer : champ de validité a placer ici a la plac du 5#}
											{% if supervisedFormation.getFormationElapsedTime > supervisedFormation.formation.validityTime %}
												<tr><td>ATTENTION LA FORMATION N'EST PLUS VALIDE</td></tr>
											{% endif %}
										</table>
									</fieldset>
			</td>
			{% if sautdeligne is odd %}
				</tr>
			{% endif %}
			{% set sautdeligne= sautdeligne+1 %}
		{% endfor %}
	</table>
{% else %}
	<h3>Cet opérateur n'a encore supervisé aucune formation</h3>
{% endif %}

{% endblock %}
